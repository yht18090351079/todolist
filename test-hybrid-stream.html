<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ··åˆæµå¼è¾“å‡ºæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f8f9fa;
        }
        .test-container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin: 0.5rem;
        }
        .btn:hover {
            background: #3182ce;
        }
        .output {
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 0.875rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            margin: 1rem 0;
            min-height: 200px;
        }
        .output.typing::after {
            content: '|';
            color: #4299e1;
            animation: blink 1s infinite;
            font-weight: bold;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        .status {
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }
        .status.success {
            background: #e6fffa;
            color: #2d3748;
            border-left: 3px solid #38b2ac;
        }
        .status.error {
            background: #fed7d7;
            color: #2d3748;
            border-left: 3px solid #e53e3e;
        }
        .status.info {
            background: #e3f2fd;
            color: #2d3748;
            border-left: 3px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸš€ æ··åˆæµå¼è¾“å‡ºæµ‹è¯•</h1>
        <p>æµ‹è¯•æ–°çš„æ··åˆæ¨¡å¼ï¼šå¿«é€Ÿè·å–å†…å®¹ + å‰ç«¯æµå¼æ˜¾ç¤º</p>
        
        <div>
            <button class="btn" onclick="testHybridStream()">æµ‹è¯•æ··åˆæµå¼è¾“å‡º</button>
            <button class="btn" onclick="testFallbackStream()">æµ‹è¯•é™çº§æµå¼è¾“å‡º</button>
            <button class="btn" onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
        </div>

        <div id="status" class="status info">
            å‡†å¤‡æµ‹è¯•...
        </div>

        <div id="output" class="output">
            ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•æ··åˆæµå¼è¾“å‡ºæ•ˆæœ
        </div>

        <div>
            <h3>ğŸ“ æµ‹è¯•è¯´æ˜</h3>
            <ul>
                <li><strong>æ··åˆæ¨¡å¼</strong>: å¿«é€Ÿè·å–å®Œæ•´å†…å®¹ï¼Œç„¶ååœ¨å‰ç«¯æ¨¡æ‹Ÿæµå¼æ˜¾ç¤º</li>
                <li><strong>é™çº§æ¨¡å¼</strong>: å½“APIè¶…æ—¶æ—¶ï¼Œä½¿ç”¨æœ¬åœ°å†…å®¹å¹¶æä¾›æµå¼æ•ˆæœ</li>
                <li><strong>ä¼˜åŠ¿</strong>: é¿å…Netlify Functions 10ç§’è¶…æ—¶é™åˆ¶</li>
                <li><strong>ä½“éªŒ</strong>: ä¿æŒæµå¼è¾“å‡ºçš„è§†è§‰æ•ˆæœï¼Œæå‡ç¨³å®šæ€§</li>
            </ul>
        </div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function simulateStreamOutput(content, outputEl) {
            return new Promise((resolve) => {
                outputEl.textContent = '';
                outputEl.classList.add('typing');
                
                let displayedContent = '';
                const words = content.split('');
                let index = 0;
                
                function typeNext() {
                    if (index < words.length) {
                        displayedContent += words[index];
                        outputEl.textContent = displayedContent;
                        outputEl.scrollTop = outputEl.scrollHeight;
                        
                        index++;
                        
                        // åŠ¨æ€è°ƒæ•´é€Ÿåº¦
                        const delay = /[ã€‚ï¼ï¼Ÿï¼Œï¼›ï¼š]/.test(words[index - 1]) ? 100 : 15;
                        setTimeout(typeNext, delay);
                    } else {
                        outputEl.classList.remove('typing');
                        resolve();
                    }
                }
                
                setTimeout(typeNext, 500);
            });
        }

        async function testHybridStream() {
            const outputEl = document.getElementById('output');
            
            updateStatus('ğŸš€ å¼€å§‹æµ‹è¯•æ··åˆæµå¼è¾“å‡º...', 'info');
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            outputEl.innerHTML = '<span style="color: #4299e1;">ğŸ¤– æ­£åœ¨è·å–AIå†…å®¹...</span>';
            
            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const mockContent = `# ğŸ“… å·¥ä½œæ—¥æŠ¥ - ${new Date().toLocaleDateString()}

## ä»Šæ—¥å·¥ä½œæ€»ç»“
ä»Šå¤©å®Œæˆäº†å¤šé¡¹é‡è¦ä»»åŠ¡ï¼Œå·¥ä½œè¿›å±•é¡ºåˆ©ã€‚é€šè¿‡æ··åˆæµå¼è¾“å‡ºæŠ€æœ¯ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†Netlify Functionsçš„è¶…æ—¶é—®é¢˜ã€‚

### ä¸»è¦æˆæœ
âœ… å®ç°äº†æ··åˆæµå¼è¾“å‡ºæ¨¡å¼
âœ… è§£å†³äº†504è¶…æ—¶é—®é¢˜
âœ… ä¿æŒäº†æµç•…çš„ç”¨æˆ·ä½“éªŒ
âœ… æå‡äº†ç³»ç»Ÿç¨³å®šæ€§

### æŠ€æœ¯äº®ç‚¹
- å¿«é€Ÿè·å–å®Œæ•´å†…å®¹ï¼Œé¿å…è¶…æ—¶
- å‰ç«¯æ¨¡æ‹Ÿæµå¼æ˜¾ç¤ºï¼Œä¿æŒè§†è§‰æ•ˆæœ
- æ™ºèƒ½é™çº§æœºåˆ¶ï¼Œç¡®ä¿åŠŸèƒ½å¯ç”¨
- åŠ¨æ€è°ƒæ•´æ‰“å­—é€Ÿåº¦ï¼Œæå‡ä½“éªŒ

## æ˜æ—¥è®¡åˆ’
- ç»§ç»­ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶
- æå‡ç³»ç»Ÿæ€§èƒ½

è¿™ç§æ··åˆæ¨¡å¼æ—¢ä¿è¯äº†åŠŸèƒ½çš„ç¨³å®šæ€§ï¼Œåˆç»´æŒäº†æµå¼è¾“å‡ºçš„è‰¯å¥½ä½“éªŒï¼`;

            updateStatus('âœ… å†…å®¹è·å–æˆåŠŸï¼Œå¼€å§‹æµå¼æ˜¾ç¤º', 'success');
            
            await simulateStreamOutput(mockContent, outputEl);
            
            updateStatus('ğŸ‰ æ··åˆæµå¼è¾“å‡ºæµ‹è¯•å®Œæˆï¼', 'success');
        }

        async function testFallbackStream() {
            const outputEl = document.getElementById('output');
            
            updateStatus('âš ï¸ æ¨¡æ‹ŸAPIè¶…æ—¶ï¼Œæµ‹è¯•é™çº§æµå¼è¾“å‡º...', 'info');
            
            outputEl.innerHTML = '<span style="color: #e53e3e;">âŒ APIè¶…æ—¶ï¼Œå¯ç”¨é™çº§æ¨¡å¼...</span>';
            
            await new Promise(resolve => setTimeout(resolve, 800));
            
            const fallbackContent = `# ğŸ“… å·¥ä½œæ—¥æŠ¥ - ${new Date().toLocaleDateString()}

## ä»Šæ—¥å·¥ä½œæ¦‚å†µ
ç”±äºç½‘ç»œåŸå› ï¼Œæ— æ³•è¿æ¥åˆ°AIæœåŠ¡ï¼Œä»¥ä¸‹ä¸ºåŸºäºä»»åŠ¡æ•°æ®çš„ç®€è¦æ€»ç»“ï¼š

## ä¸»è¦æˆæœ
- æŒ‰è®¡åˆ’æ¨è¿›é¡¹ç›®ä»»åŠ¡
- ä¿æŒè‰¯å¥½çš„å·¥ä½œèŠ‚å¥
- ç§¯æé…åˆå›¢é˜Ÿåä½œ

## é™çº§æ¨¡å¼ä¼˜åŠ¿
- å³ä½¿APIè¶…æ—¶ä¹Ÿèƒ½æä¾›å†…å®¹
- ä¿æŒæµå¼è¾“å‡ºçš„è§†è§‰æ•ˆæœ
- ç¡®ä¿ç”¨æˆ·ä½“éªŒçš„è¿ç»­æ€§

## å·¥ä½œå»ºè®®
- ç»§ç»­ä¿æŒå½“å‰çš„å·¥ä½œçŠ¶æ€
- å…³æ³¨é‡è¦ä»»åŠ¡çš„è¿›å±•
- åŠ å¼ºå›¢é˜Ÿæ²Ÿé€šåä½œ

*æ³¨ï¼šæ­¤ä¸ºç½‘ç»œå¼‚å¸¸æ—¶çš„é™çº§æŠ¥å‘Šï¼Œå»ºè®®ç¨åé‡è¯•ä»¥è·å¾—AIç”Ÿæˆçš„è¯¦ç»†æŠ¥å‘Šã€‚*`;

            updateStatus('ğŸ”„ ä½¿ç”¨é™çº§å†…å®¹ï¼Œæä¾›æµå¼æ˜¾ç¤º', 'info');
            
            await simulateStreamOutput(fallbackContent, outputEl);
            
            updateStatus('âœ… é™çº§æµå¼è¾“å‡ºæµ‹è¯•å®Œæˆï¼', 'success');
        }

        function clearOutput() {
            document.getElementById('output').textContent = 'è¾“å‡ºå·²æ¸…ç©ºï¼Œå‡†å¤‡ä¸‹æ¬¡æµ‹è¯•...';
            updateStatus('å‡†å¤‡æµ‹è¯•...', 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.onload = function() {
            console.log('ğŸ§ª æ··åˆæµå¼è¾“å‡ºæµ‹è¯•é¡µé¢å·²åŠ è½½');
        };
    </script>
</body>
</html>
