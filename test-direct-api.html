<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ¥è°ƒç”¨è±†åŒ…APIæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 0.875rem;
        }
        .btn:hover {
            background: #3182ce;
        }
        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        .output {
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 0.875rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            margin: 1rem 0;
            min-height: 200px;
        }
        .status {
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }
        .status.success {
            background: #e6fffa;
            color: #2d3748;
            border-left: 3px solid #38b2ac;
        }
        .status.error {
            background: #fed7d7;
            color: #2d3748;
            border-left: 3px solid #e53e3e;
        }
        .status.info {
            background: #e3f2fd;
            color: #2d3748;
            border-left: 3px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– ç›´æ¥è°ƒç”¨è±†åŒ…APIæµ‹è¯•</h1>
        <p>æµ‹è¯•åœ¨ç½‘é¡µä¸­ç›´æ¥è°ƒç”¨è±†åŒ…APIï¼Œä¸é€šè¿‡åç«¯ä»£ç†</p>
        
        <div>
            <button class="btn" onclick="testDirectCall()" id="testBtn">æµ‹è¯•ç›´æ¥è°ƒç”¨</button>
            <button class="btn" onclick="testDailyReport()" id="dailyBtn">æµ‹è¯•æ—¥æŠ¥ç”Ÿæˆ</button>
            <button class="btn" onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
        </div>

        <div id="status" class="status info">
            å‡†å¤‡æµ‹è¯•ç›´æ¥è°ƒç”¨è±†åŒ…API...
        </div>

        <div id="output" class="output">
            ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•
        </div>

        <div>
            <h3>ğŸ“ æµ‹è¯•è¯´æ˜</h3>
            <ul>
                <li><strong>ç›´æ¥è°ƒç”¨</strong>: ç½‘é¡µç›´æ¥è°ƒç”¨è±†åŒ…APIï¼Œæ— éœ€åç«¯ä»£ç†</li>
                <li><strong>CORSå¤„ç†</strong>: å¦‚æœé‡åˆ°CORSé”™è¯¯ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨é™çº§æ¨¡å¼</li>
                <li><strong>ä¼˜åŠ¿</strong>: é¿å…Netlify Functions 10ç§’è¶…æ—¶é™åˆ¶</li>
                <li><strong>é™çº§æœºåˆ¶</strong>: ç½‘ç»œé—®é¢˜æ—¶æä¾›åŸºç¡€æŠ¥å‘Šå†…å®¹</li>
            </ul>
        </div>
    </div>

    <script>
        // è±†åŒ…APIé…ç½®
        const DOUBAO_CONFIG = {
            API_URL: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
            API_KEY: 'e90111f2-f6a4-40c3-a657-b8383007166f',
            MODEL: 'doubao-seed-1-6-250615'
        };

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function setButtonsDisabled(disabled) {
            document.getElementById('testBtn').disabled = disabled;
            document.getElementById('dailyBtn').disabled = disabled;
        }

        async function testDirectCall() {
            const outputEl = document.getElementById('output');
            
            updateStatus('ğŸš€ å¼€å§‹æµ‹è¯•ç›´æ¥è°ƒç”¨è±†åŒ…API...', 'info');
            setButtonsDisabled(true);
            
            try {
                outputEl.textContent = 'æ­£åœ¨è°ƒç”¨è±†åŒ…API...';
                
                const messages = [
                    {
                        role: 'user',
                        content: 'ä½ å¥½ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±ã€‚'
                    }
                ];

                const response = await fetch(DOUBAO_CONFIG.API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DOUBAO_CONFIG.API_KEY}`
                    },
                    body: JSON.stringify({
                        model: DOUBAO_CONFIG.MODEL,
                        messages: messages,
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                outputEl.textContent = content;
                updateStatus('âœ… ç›´æ¥è°ƒç”¨æˆåŠŸï¼', 'success');
                
            } catch (error) {
                console.error('ç›´æ¥è°ƒç”¨å¤±è´¥:', error);
                
                if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                    outputEl.textContent = `âŒ CORSé”™è¯¯: ${error.message}\n\nè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè±†åŒ…APIä¸æ”¯æŒè·¨åŸŸè°ƒç”¨ã€‚\nåœ¨å®é™…åº”ç”¨ä¸­ä¼šä½¿ç”¨é™çº§æ¨¡å¼æä¾›åŸºç¡€æŠ¥å‘Šã€‚`;
                    updateStatus('âš ï¸ é‡åˆ°CORSé™åˆ¶ï¼Œè¿™æ˜¯é¢„æœŸçš„', 'error');
                } else {
                    outputEl.textContent = `âŒ è°ƒç”¨å¤±è´¥: ${error.message}`;
                    updateStatus('âŒ è°ƒç”¨å¤±è´¥', 'error');
                }
            } finally {
                setButtonsDisabled(false);
            }
        }

        async function testDailyReport() {
            const outputEl = document.getElementById('output');
            
            updateStatus('ğŸ“… æµ‹è¯•æ—¥æŠ¥ç”Ÿæˆï¼ˆé™çº§æ¨¡å¼ï¼‰...', 'info');
            setButtonsDisabled(true);
            
            try {
                // æ¨¡æ‹Ÿé™çº§æŠ¥å‘Šç”Ÿæˆ
                const today = new Date().toLocaleDateString('zh-CN');
                const fallbackContent = `# ğŸ“… å·¥ä½œæ—¥æŠ¥ - ${today}

## ä»Šæ—¥å·¥ä½œæ€»ç»“
ç”±äºç½‘ç»œåŸå› ï¼Œæ— æ³•è¿æ¥åˆ°AIæœåŠ¡ï¼Œä»¥ä¸‹ä¸ºåŸºäºä»»åŠ¡æ•°æ®çš„ç®€è¦æ€»ç»“ï¼š

## ä¸»è¦å·¥ä½œå†…å®¹
- æŒ‰è®¡åˆ’æ¨è¿›å„é¡¹ä»»åŠ¡
- ä¿æŒè‰¯å¥½çš„å·¥ä½œèŠ‚å¥
- ç§¯æé…åˆå›¢é˜Ÿåä½œ

## å·¥ä½œå»ºè®®
- ç»§ç»­ä¿æŒå½“å‰çš„å·¥ä½œçŠ¶æ€
- å…³æ³¨é‡è¦ä»»åŠ¡çš„è¿›å±•
- åŠ å¼ºå›¢é˜Ÿæ²Ÿé€šåä½œ

## å¤‡æ³¨
*æ­¤ä¸ºç½‘ç»œå¼‚å¸¸æ—¶çš„é™çº§æŠ¥å‘Šï¼Œå»ºè®®ç¨åé‡è¯•ä»¥è·å¾—AIç”Ÿæˆçš„è¯¦ç»†æŠ¥å‘Šã€‚*`;

                // æ¨¡æ‹Ÿæ‰“å­—æœºæ•ˆæœ
                outputEl.textContent = '';
                let index = 0;
                
                function typeWriter() {
                    if (index < fallbackContent.length) {
                        outputEl.textContent += fallbackContent.charAt(index);
                        index++;
                        setTimeout(typeWriter, 20);
                    } else {
                        updateStatus('âœ… é™çº§æ¨¡å¼æ—¥æŠ¥ç”Ÿæˆå®Œæˆ', 'success');
                        setButtonsDisabled(false);
                    }
                }
                
                setTimeout(typeWriter, 500);
                
            } catch (error) {
                outputEl.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
                updateStatus('âŒ æµ‹è¯•å¤±è´¥', 'error');
                setButtonsDisabled(false);
            }
        }

        function clearOutput() {
            document.getElementById('output').textContent = 'è¾“å‡ºå·²æ¸…ç©ºï¼Œå‡†å¤‡ä¸‹æ¬¡æµ‹è¯•...';
            updateStatus('å‡†å¤‡æµ‹è¯•...', 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.onload = function() {
            console.log('ğŸ§ª ç›´æ¥è°ƒç”¨æµ‹è¯•é¡µé¢å·²åŠ è½½');
            updateStatus('å‡†å¤‡æµ‹è¯•ç›´æ¥è°ƒç”¨è±†åŒ…API...', 'info');
        };
    </script>
</body>
</html>
