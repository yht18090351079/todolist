<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯APIè°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .debug-card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 12px; white-space: pre-wrap; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <h1>ğŸ› å‰ç«¯APIè°ƒè¯•</h1>
    
    <div class="debug-card">
        <h2>æµ‹è¯•æ›´æ–°ä»»åŠ¡API</h2>
        <button onclick="testUpdateTask()">æµ‹è¯•æ›´æ–°ä»»åŠ¡</button>
        <div id="updateLog" class="log"></div>
    </div>

    <div class="debug-card">
        <h2>ç›´æ¥æµ‹è¯•Netlify Functions</h2>
        <button onclick="testNetlifyDirect()">ç›´æ¥è°ƒç”¨Netlify</button>
        <div id="netlifyLog" class="log"></div>
    </div>

    <script src="feishu-api.js"></script>
    <script>
        function log(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
        }

        async function testUpdateTask() {
            const logElement = document.getElementById('updateLog');
            logElement.innerHTML = '';
            
            log('updateLog', 'å¼€å§‹æµ‹è¯•å‰ç«¯API...');
            
            try {
                const testData = {
                    title: 'å‰ç«¯æµ‹è¯•-' + Date.now(),
                    project: 'æµ‹è¯•é¡¹ç›®',
                    assignee: 'æµ‹è¯•äººå‘˜',
                    dueDate: '',
                    completed: false
                };

                log('updateLog', 'è°ƒç”¨ feishuTaskAPI.updateTask...');
                log('updateLog', 'æµ‹è¯•æ•°æ®: ' + JSON.stringify(testData, null, 2));

                const result = await window.feishuTaskAPI.updateTask('recAhumGQj', testData);
                
                log('updateLog', 'å‰ç«¯APIè¿”å›ç»“æœ: ' + JSON.stringify(result, null, 2));
                
                if (result.success) {
                    log('updateLog', 'âœ… å‰ç«¯APIè°ƒç”¨æˆåŠŸ!');
                } else {
                    log('updateLog', 'âŒ å‰ç«¯APIè°ƒç”¨å¤±è´¥: ' + result.error, true);
                }
                
            } catch (error) {
                log('updateLog', 'âŒ å‰ç«¯APIå¼‚å¸¸: ' + error.message, true);
                log('updateLog', 'é”™è¯¯å †æ ˆ: ' + error.stack, true);
            }
        }

        async function testNetlifyDirect() {
            const logElement = document.getElementById('netlifyLog');
            logElement.innerHTML = '';
            
            log('netlifyLog', 'å¼€å§‹ç›´æ¥æµ‹è¯•Netlify Functions...');
            
            try {
                const testData = {
                    taskId: 'recAhumGQj',
                    title: 'ç›´æ¥æµ‹è¯•-' + Date.now(),
                    project: 'æµ‹è¯•é¡¹ç›®',
                    assignee: 'æµ‹è¯•äººå‘˜',
                    dueDate: '',
                    completed: false
                };

                log('netlifyLog', 'è¯·æ±‚URL: https://tasklit.netlify.app/.netlify/functions/update-task');
                log('netlifyLog', 'è¯·æ±‚æ•°æ®: ' + JSON.stringify(testData, null, 2));

                const response = await fetch('https://tasklit.netlify.app/.netlify/functions/update-task', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                log('netlifyLog', 'HTTPçŠ¶æ€: ' + response.status);
                log('netlifyLog', 'HTTPçŠ¶æ€æ–‡æœ¬: ' + response.statusText);
                log('netlifyLog', 'HTTP OK: ' + response.ok);

                const result = await response.json();
                log('netlifyLog', 'Netlifyå“åº”: ' + JSON.stringify(result, null, 2));
                
                if (result.success) {
                    log('netlifyLog', 'âœ… Netlify Functionsè°ƒç”¨æˆåŠŸ!');
                } else {
                    log('netlifyLog', 'âŒ Netlify Functionsè¿”å›å¤±è´¥: ' + result.message, true);
                }
                
            } catch (error) {
                log('netlifyLog', 'âŒ Netlify Functionså¼‚å¸¸: ' + error.message, true);
                log('netlifyLog', 'é”™è¯¯å †æ ˆ: ' + error.stack, true);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰é…ç½®
        window.onload = function() {
            log('updateLog', 'å‰ç«¯APIé…ç½®:');
            log('updateLog', 'ä»£ç†URL: ' + window.feishuTaskAPI.proxyUrl);
            log('netlifyLog', 'å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
        };
    </script>
</body>
</html>
